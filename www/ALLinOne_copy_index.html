<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
  <script src="components/loader.js"></script>
  <script src="lib/onsenui/js/onsenui.min.js"></script>
<!-- Openlayers 4 set -->
  <script src="https://openlayers.org/en/v4.6.4/build/ol.js"></script>
  <link rel="stylesheet" href="https://openlayers.org/en/v4.6.4/css/ol.css" type="text/css">
<!-- jQuery -->
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <!--<script src="http://maps.google.com/maps/api/js?libraries=geometry&sensor=true"type="text/javascript"></script>-->

  <link rel="stylesheet" href="components/loader.css">
  <link rel="stylesheet" href="lib/onsenui/css/onsenui.css">
  <link rel="stylesheet" href="lib/onsenui/css/onsen-css-components.css">
  <link rel="stylesheet" href="css/style.css">

  <script>
    ons.ready(function() {
      console.log("Onsen UI is ready!");
    });
  </script>
  
<!-- MapCreate Javascript 
  <script src="mapCreate.js" type="text/javascript"></script>-->
  
</head>
<body> <!-- onload="GetPosition()">-->
  <ons-page>
    <ons-tabbar position="auto">
      <ons-tab label="地　図" page="tab1.html" active></ons-tab>
      <ons-tab label="情報選択" page="tab2.html"></ons-tab>
      <ons-tab label="そ の 他" page="tab3.html"></ons-tab>
      <ons-tab label="履　歴" page="tab4.html"></ons-tab>
    </ons-tabbar>
  </ons-page>

  <ons-template id="tab1.html">
    <ons-page id="first-page">
        <!--map display-->
    <div id="map" style="float:left; width:100%; height:100%;"></div>
    </ons-page>
  </ons-template>

  <ons-template id="tab2.html">
    <ons-page id="second-page">
          <div id="sampleButton">
            <form name="myForm">
          <!--ラジオボタン↓-->
            <!--select name="myRadio" onChange ="SetPicture()">-->
              <section style = "paddin: 20px">
                <label class = "radio-button radio-button--material">
                    &emsp;<img src="iCon/OneSoldier.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=1 checked="checked" /><label>兵　員</label>
                    <img src="iCon/FewSoldier.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=2 /><label>兵数名</label><br><br>
                    &emsp;<img src="iCon/SoldierMarching.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=3 /><label>多数兵</label>
                    <img src="iCon/ArmorVehicle.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=4 /><label>戦闘車</label><br><br>
                    &emsp;<img src="iCon/MoterBick.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=5 /><label>バイク</label>
                    <img src="iCon/Track.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=6 /><label>トラｯｸ</label><br><br>
                    &emsp;<img src="iCon/VehicleMarching.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=7 /><label>車多数</label>
                    <img src="iCon/Tnk.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=8 /><label>戦　車</label><br><br>
                    &emsp;<img src="iCon/CloudCar.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=9 /><label>渋　滞</label>
                    <img src="iCon/FixWing.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=10 /><label>戦闘機</label><br><br>
                    &emsp;<img src="iCon/Hel.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=11 /><label>へ　リ</label>
                    <img src="iCon/SoldierFiring.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=12 /><label>発　砲</label><br><br>
                    &emsp;<img src="iCon/FiringSound.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=13 /><label>発砲音</label>
                    <img src="iCon/bomb.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=14 /><label>爆　発</label><br><br>
                    &emsp;<img src="iCon/BombSound.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=15 /><label>爆発音</label>
                    <img src="iCon/Smoke.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=16 /><label>　煙　</label><br><br>
                    &emsp;<img src="iCon/Destroy.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=17 /><label>破　壊</label>
                    <img src="iCon/Unknown.gif" align="absbottom">
                    <input type="radio" name="myRadio" value=18 /><label>不　明</label><br>
                </label>                                  
              </section>
            </form>
          </div>
    </ons-page>
  </ons-template>

  <ons-template id="tab3.html">
    <ons-page id="Third-page">
          <div id="sampleButton">
            <form name="myForm">
          <!--ラジオボタン↓-->
            <!--select name="myRadio" onChange ="SetPicture()">-->
              <section style = "paddin: 20px">
                <label class = "radio-button radio-button--material">
                  &emsp;<img src="iCon/Bus.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=19 /><label>バ　ス</label>
                  <img src="iCon/CivilCar.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=20 /><label>民間車</label><br>
                  &emsp;<img src="iCon/Cvilian.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=21 /><label>民間人</label>
                  <img src="iCon/Police.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=22 /><label>警察官</label><br>
                  &emsp;<img src="iCon/Injured.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=23 /><label>負傷者</label>
                  <img src="iCon/Cliff.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=24 /><label>崖崩れ</label><br>
                  &emsp;<img src="iCon/Tsunami.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=25 /><label>津　波</label>
                  <img src="iCon/Flood.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=26 /><label>洪　水</label><br>
                  &emsp;<img src="iCon/Fire.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=27 /><label>火　災</label>
                  <img src="iCon/緊急避難場所.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=28 /><label>緊避所</label><br>
                  &emsp;<img src="iCon/EvacuSite.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=29 /><label>避難場</label>
                  <img src="iCon/避難場所兼緊急避難場所.gif" align="absbottom">
                  <input type="radio" name="myRadio" value=30 /><label>緊＆避</label><br>
                </label>                                  
              </section>
            </form>
          </div>
    </ons-page>
  </ons-template>

  <ons-template id="tab4.html">
    <ons-page id="forth-page">
      <p style="text-align: center;">
        This is the forth page.
      </p>
    </ons-page>
  </ons-template>

  <script type="text/javascript">
    var initZoom = 14                       ; // ズームの初期値
    var MinZoom  = 1                        ; // ズームの最小値（最も広い範囲）
    var MaxZoom  = 20                       ; // ズームの最大値（最も狭い範囲）
    // ***********************************************************************
    var CheckActionNo = 1                   ; // 選択 ActionNo
    var picName = "iCon/HeadingLarge.gif"   ; // 表示 Marker名
    var MarkerID = 0                        ; // MarkerID
    var center_lon = 135.100303888          ; // 中心の経度（須磨浦公園）
    var center_lat = 34.637674639           ; // 中心の緯度（須磨浦公園）
    var Heading;
    var Speed;
        
    // click 状況
    $(function(){
        $( 'input[name="myRadio"]:radio' ).change( function() {
          var radioval = $(this).val();
          //PicName = "iCon/" + ActionPictures[radioval];
          CheckActionNo = radioval;
        });
    });

    // 表示用の view 変数の定義。
    var view;
    // 情報プロットレイヤーの定義
    var vectorLayer = new ol.layer.Vector({ source: new ol.source.Vector() });
    // cyberJ（地理院地図）用の変数
    var cyberJ = new ol.layer.Tile({
        opacity: 0.95,
        source: new ol.source.XYZ({
          attributions  : [ new ol.Attribution({ html: "<a href='http://maps.gsi.go.jp/development/ichiran.html' target='_blank'>国土地理院</a>" }) ],
          url           : "http://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",
          projection    : "EPSG:3857"
        })
    });
    // 地図変数 (map 変数) の定義（地理院地図を表示するように指定）
    var map 
    
    GetPosition();
    
    function GetPosition(){
        navigator.geolocation.watchPosition(onSuccess, onError);
    }
    //--------------------------------------------------------------------
    function init_map(Latitude,Longitude,Heading,Speed) {// click 状況
        // 表示用の view 変数の定義。
        view = new ol.View({
            projection  : "EPSG:3857",
            maxZoom     : MaxZoom,
            minZoom     : MinZoom,
            center      : convertCoordinate(center_lon, center_lat),
            zoom        : initZoom
        })
        // 地図変数 (map 変数) の定義（地理院地図を表示するように指定）
        map = new ol.Map({
            target  : 'map',
            view    : view,
            layers  : [cyberJ, vectorLayer],//create a point
            controls: ol.control.defaults().extend([new ol.control.ScaleLine()])//<-----スケールラインコントロール set
        });
        //var picName_ = "iCon/HeadingLarge.gif";
        //var MarkerID = 0;
        addMarker(MarkerID,Longitude,Latitude,picName,map,Heading,Speed);
        view.setCenter(ol.proj.transform([Longitude,Latitude], "EPSG:4326", "EPSG:3857"));
        
        map.on('singleclick', function(evt) {
            var coordinate = evt.coordinate;
            var pos = ol.proj.transform(coordinate, "EPSG:3857", "EPSG:4326");  //<---------緯度経度への変換
            Lon_Point = pos[0];
            Lat_Point = pos[1];
            MarkerID =1;
            picName = "iCon/Bus.gif";
            alert(MarkerID);
            addMarker(MarkerID,Lon_Point,Lat_Point,picName,map,Heading,Speed);
        })
    }// function init_map
    //--- onSuccess Callback---------------------------------------------
    function onSuccess(position) {
        var Latitude = position.coords.latitude;
        var Longitude = position.coords.longitude;
        Heading = position.coords.heading;
        Speed = position.coords.speed;
        if(Speed <= 0){
            Heading = 0;
            Speed = 0;
        }
        init_map(Latitude,Longitude,Heading,Speed);
    };// function onSuccess()
    //--- onError Callback receives a PositionError object ---------------
    function onError(error) {
        alert('code: '    + error.code    + '\n' +
                'message: ' + error.message + '\n');
    }// function onError()
    
    //--- 表示用緯度経度への変換 -----------------------------------------
    function convertCoordinate(longitude, latitude) {
        return ol.proj.transform([longitude, latitude], "EPSG:4326","EPSG:3857");
    };//function convertCoordinate
    
    //create a point
    function addMarker(markerID,lon, lat,picName_,map,Heading,Speed){
        var geom = new ol.geom.Point( ol.proj.transform([lon, lat], 'EPSG:4326', 'EPSG:3857') );
        var feature = new ol.Feature(geom);
        var ObjTXT;
        if (markerID == 0){
              ObjTXT = "MyPost";
        }else{
              ObjTXT = "T_" + String(markerID);
        };
            feature.setStyle([
            new ol.style.Style({
              image: new ol.style.Icon(({
                  anchor: [0.5, 0.5],
                  anchorXUnits: 'fraction',
                  anchorYUnits: 'fraction',
                  opacity     : 1,
                  rotation    : Heading,
                  src         : picName_//'iCon/Heading.gif'
              })),
              text: new ol.style.Text({
                  offsetX: 35,
                  offsetY: -15,
                  text: ObjTXT,
                  font: '15px Open Sans,sans-serif',
                  fill: new ol.style.Fill({ color: '#111' }),
                  stroke: new ol.style.Stroke({ color: '#eee', width: 2 })
              })
            })
        ]);
        feature.setId(markerID);//------------------------------------- 追加 Marker へのID set
        map.getLayers().item(1).getSource().addFeature(feature);
    };//ENDOF create a point
  </script>
</body>
</html>

